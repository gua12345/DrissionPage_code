import{g as at,u as Y,s as W,d as ct,c as lt,a as Z,b as je}from"./_commonjsHelpers-a2c207ad.js";import{R as D,H as q}from"./enum-16183e1b.js";var ut=function(o){return pt(o)&&!dt(o)};function pt(r){return!!r&&typeof r=="object"}function dt(r){var o=Object.prototype.toString.call(r);return o==="[object RegExp]"||o==="[object Date]"||wt(r)}var gt=typeof Symbol=="function"&&Symbol.for,ft=gt?Symbol.for("react.element"):60103;function wt(r){return r.$$typeof===ft}function bt(r){return Array.isArray(r)?[]:{}}function L(r,o){return o.clone!==!1&&o.isMergeableObject(r)?x(bt(r),r,o):r}function mt(r,o,s){return r.concat(o).map(function(l){return L(l,s)})}function yt(r,o){if(!o.customMerge)return x;var s=o.customMerge(r);return typeof s=="function"?s:x}function ht(r){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r).filter(function(o){return Object.propertyIsEnumerable.call(r,o)}):[]}function de(r){return Object.keys(r).concat(ht(r))}function ve(r,o){try{return o in r}catch{return!1}}function Ot(r,o){return ve(r,o)&&!(Object.hasOwnProperty.call(r,o)&&Object.propertyIsEnumerable.call(r,o))}function jt(r,o,s){var l={};return s.isMergeableObject(r)&&de(r).forEach(function(u){l[u]=L(r[u],s)}),de(o).forEach(function(u){Ot(r,u)||(ve(r,u)&&s.isMergeableObject(o[u])?l[u]=yt(u,s)(r[u],o[u],s):l[u]=L(o[u],s))}),l}function x(r,o,s){s=s||{},s.arrayMerge=s.arrayMerge||mt,s.isMergeableObject=s.isMergeableObject||ut,s.cloneUnlessOtherwiseSpecified=L;var l=Array.isArray(o),u=Array.isArray(r),g=l===u;return g?l?s.arrayMerge(r,o,s):jt(r,o,s):L(o,s)}x.all=function(o,s){if(!Array.isArray(o))throw new Error("first argument should be an array");return o.reduce(function(l,u){return x(l,u,s)},{})};var vt=x,Dt=vt;const De=at(Dt),ge=async r=>{const o=await chrome.tabs.query({});if(Array.isArray(r)){const s=new Set(r);return o.filter(l=>{if(l.url){const u=Y(l.url);return u&&s.has(u)}})}else return o.filter(s=>s.url&&r===Y(s.url))},St=async(r,o)=>{const s=await chrome.tabs.query({});for(const l of s)l.id&&chrome.tabs.sendMessage(l.id,r,o)},fe=(r,o)=>chrome.tabs.sendMessage(r,{type:D.ChangeScriptWhitelist,mode:o}),Et=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( \((?<engineDetails>.+?)\))?( (?<extensions>.+?))?$/,Ct=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( (?<extensions>.+?))?/;class I{name;version;constructor(o,s){this.name=o,this.version=s}static parse(o){const s=o.split("/");return new I(s[0],s[1])}toString(){return this.version?`${this.name}/${this.version}`:this.name}setName(o){this.name=o}setVersion(o){this.version=o}}class xt{type;product;systemInfo;engine;engineDetails;extensions;constructor(o){let s;if(o.includes("Firefox")?(this.type="firefox",s=o.match(Ct)?.groups):(this.type="base",s=o.match(Et)?.groups),!s)throw new Error("unable to parse");this.product=I.parse(s.product),this.systemInfo=s.systemInfo.split(";").map(l=>l.trim()),this.engine=s.engine?.split(" ").map(l=>I.parse(l)),this.engineDetails=s.engineDetails?.split(",").map(l=>l.trim()),this.extensions=s.extensions?.split(" ").map(l=>I.parse(l))}toString(o){let s;o?s=this.product.version:s=this.product.toString();const l=this.systemInfo.join("; "),u=this.engine?.map(f=>f.toString()).join(" "),g=this.extensions?.map(f=>f.toString()).join(" ");if(this.type==="firefox")return`${s} (${l}) ${u} ${g}`;{const f=this.engineDetails?.join(", ");return`${s} (${l}) ${u} (${f}) ${g}`}}}const we=(r,o)=>({...o,version:o.version&&W(r,o.version).full}),At=async(r,o)=>{if(!o.userAgentData||!o.userAgentData.brands)return{};const s={brands:o.userAgentData.brands.map(l=>we(r,l))};if(o.userAgentData.getHighEntropyValues){const{fullVersionList:l,uaFullVersion:u}=await o.userAgentData.getHighEntropyValues(["fullVersionList","uaFullVersion"]);s.fullVersionList=l?.map(g=>we(r,g)),s.uaFullVersion=u&&W(r,u).full}return s},be=new Map,Rt=(r,o,s)=>{const l=s?"app":"ua";let u=be.get(o.userAgent);if(u)return u[l];try{const g=new xt(o.userAgent);g.engine?.length&&g.engine.forEach(f=>f.version&&f.setVersion(W(r,f.version).full)),g.extensions?.length&&g.extensions.forEach(f=>f.version&&f.setVersion(W(r,f.version).full)),u={ua:g.toString(),app:g.toString(s)},be.set(o.userAgent,u)}catch{return s?o.appVersion:o.userAgent}return u[l]};function Mt(r,o){function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l=function(t){return u(t)&&!g(t)};function u(e){return!!e&&typeof e=="object"}function g(e){var t=Object.prototype.toString.call(e);return t==="[object RegExp]"||t==="[object Date]"||Ce(e)}var f=typeof Symbol=="function"&&Symbol.for,Ee=f?Symbol.for("react.element"):60103;function Ce(e){return e.$$typeof===Ee}function xe(e){return Array.isArray(e)?[]:{}}function A(e,t){return t.clone!==!1&&t.isMergeableObject(e)?S(xe(e),e,t):e}function Ae(e,t,n){return e.concat(t).map(function(i){return A(i,n)})}function Re(e,t){if(!t.customMerge)return S;var n=t.customMerge(e);return typeof n=="function"?n:S}function Me(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return Object.propertyIsEnumerable.call(e,t)}):[]}function Q(e){return Object.keys(e).concat(Me(e))}function ee(e,t){try{return t in e}catch{return!1}}function Te(e,t){return ee(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))}function Ie(e,t,n){var i={};return n.isMergeableObject(e)&&Q(e).forEach(function(a){i[a]=A(e[a],n)}),Q(t).forEach(function(a){Te(e,a)||(ee(e,a)&&n.isMergeableObject(t[a])?i[a]=Re(a,n)(e[a],t[a],n):i[a]=A(t[a],n))}),i}function S(e,t,n){n=n||{},n.arrayMerge=n.arrayMerge||Ae,n.isMergeableObject=n.isMergeableObject||l,n.cloneUnlessOtherwiseSpecified=A;var i=Array.isArray(t),a=Array.isArray(e),c=i===a;return c?i?n.arrayMerge(e,t,n):Ie(e,t,n):A(t,n)}S.all=function(t,n){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(i,a){return S(i,a,n)},{})};var Le=S,Pe=Le,Ve=s(Pe),w;(function(e){e[e.default=0]="default",e[e.value=1]="value",e[e.page=2]="page",e[e.browser=3]="browser",e[e.domain=4]="domain",e[e.global=5]="global"})(w||(w={}));var te;(function(e){e.SetConfig="set-config",e.GetNotice="get-notice",e.SetHookRecords="set-hook-records",e.UpdateWhitelist="update-whitelist",e.ChangeScriptWhitelist="change-script-whitelist",e.GetNewVersion="get-new-version"})(te||(te={}));var R;(function(e){e.SetConfig="set-config",e.SetHookRecords="set-hook-records",e.ChangeWhitelist="change-whitelist"})(R||(R={}));const E=function(e,t,n){t=t??1,n=n??0,e=(e*9301+49297)%233280;const i=e/233280;return n+i*(t-n)},V=(e,t)=>e[t%e.length],Fe=[8,12,16],Ue=[16,24,32],Ne=[16,24,32],ne=e=>{const t=e%100-50,n=screen.width,i=screen.height,a=n+t;return{width:a,height:Math.round(a*i/n)}},He=e=>V(navigator.languages,e),$e=e=>V(Fe,e),Be=e=>V(Ue,e),_e=e=>V(Ne,e),We=e=>{const t=[];for(let n=0;n<10;n++)t.push(Math.floor(E(e++,255,0)));return t},qe=e=>E(e),ze=e=>[E(e,1,-1),E(e+1,1,-1)],ke=function(e,t){t=t||300;var n;return function(...i){clearTimeout(n),n=setTimeout(()=>e(...i),t)}},re="__MyFingerprint__",Ge=e=>e[re],Ye=e=>({[re]:e}),Ze=e=>{postMessage(Ye({type:R.SetHookRecords,data:e}),location.origin)},oe=function(){return Math.floor(Math.random()*Math.pow(2,32))},Ke=e=>{let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t=(t<<5)-t+i,t=t&t}return t%2147483647},Xe=function(e){try{let t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")return;let n=t.hostname,i=t.port;return i===""&&(t.protocol==="http:"?i="80":t.protocol==="https:"&&(i="443")),`${n}:${i}`}catch{return}},F=(e,t,n=100,i)=>{const[a,...c]=t.split(".");if(c.length===0)return{major:a,full:a};i=i??c.length;const p=[];for(let d=0;d<i;d++){const m=Number(c[d]);if(isNaN(m)){p.push(c[d]);continue}const b=Math.floor(E(e+d,n,0));p.push(b.toString())}return{major:a,full:[a,...p].join(".")}},Je=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( \((?<engineDetails>.+?)\))?( (?<extensions>.+?))?$/,Qe=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( (?<extensions>.+?))?/;class M{name;version;constructor(t,n){this.name=t,this.version=n}static parse(t){const n=t.split("/");return new M(n[0],n[1])}toString(){return this.version?`${this.name}/${this.version}`:this.name}setName(t){this.name=t}setVersion(t){this.version=t}}class et{type;product;systemInfo;engine;engineDetails;extensions;constructor(t){let n;if(t.includes("Firefox")?(this.type="firefox",n=t.match(Qe)?.groups):(this.type="base",n=t.match(Je)?.groups),!n)throw new Error("unable to parse");this.product=M.parse(n.product),this.systemInfo=n.systemInfo.split(";").map(i=>i.trim()),this.engine=n.engine?.split(" ").map(i=>M.parse(i)),this.engineDetails=n.engineDetails?.split(",").map(i=>i.trim()),this.extensions=n.extensions?.split(" ").map(i=>M.parse(i))}toString(t){let n;t?n=this.product.version:n=this.product.toString();const i=this.systemInfo.join("; "),a=this.engine?.map(p=>p.toString()).join(" "),c=this.extensions?.map(p=>p.toString()).join(" ");if(this.type==="firefox")return`${n} (${i}) ${a} ${c}`;{const p=this.engineDetails?.join(", ");return`${n} (${i}) ${a} (${p}) ${c}`}}}const U=(e,t)=>({...t,version:t.version&&F(e,t.version).full}),ie=new Map,se=(e,t,n)=>{const i=n?"app":"ua";let a=ie.get(t.userAgent);if(a)return a[i];try{const c=new et(t.userAgent);c.engine?.length&&c.engine.forEach(p=>p.version&&p.setVersion(F(e,p.version).full)),c.extensions?.length&&c.extensions.forEach(p=>p.version&&p.setVersion(F(e,p.version).full)),a={ua:c.toString(),app:c.toString(n)},ie.set(t.userAgent,a)}catch{return n?t.appVersion:t.userAgent}return a[i]},N=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3],T=(e,t,n)=>{t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3]},ae=(e,t,n,i,a,c,p,d)=>{const m=e.call(n,i,a,c,p,d);let b=0,h=!1;const y=new Uint8ClampedArray(4),$=new Uint8ClampedArray(4),B=new Uint8ClampedArray(4),O=new Uint8ClampedArray(4),ue=new Uint8ClampedArray(4),C=m.data;e:for(let j=1;j<p-2;j+=2)for(let v=1;v<c-2;v+=2){if(t.length===b)break e;const pe=(j*c+v)*4;T(C,y,pe),T(C,$,((j-1)*c+v)*4),!N(y,$)&&(T(C,B,((j+1)*c+v)*4),!N(y,B)&&(T(C,O,(j*c+(v-1))*4),!N(y,O)&&(T(C,ue,(j*c+(v+1))*4),!N(y,ue)&&(C[pe+3]=t[b++]%256,h=!0))))}return h&&n.putImageData(m,i,a),m},tt=(e,t)=>{if(t)return new Proxy(t,{get:(n,i)=>{switch(i){case"brands":{const c=n[i];return c?.map?.(d=>U(e,d))??c}case"toJSON":{const c=n[i];return c&&new Proxy(c.bind(n),{apply:(p,d,m)=>{const b=p.apply(d,m);return b?.brands?.map?.(y=>U(e,y))??b}})}case"getHighEntropyValues":{const c=n[i];return c&&new Proxy(c.bind(n),{apply:(p,d,m)=>p.apply(d,m)?.then(b=>b&&{...b,brands:b.brands?.map?.(h=>U(e,h)),fullVersionList:b.fullVersionList?.map?.(h=>U(e,h)),uaFullVersion:b.uaFullVersion&&F(e,b.uaFullVersion).full})})}}const a=n[i];return typeof a=="function"?a.bind(n):a}})},ce=(e,t)=>{const n="attribute vec4 noise;void main() {gl_Position = noise;gl_PointSize = 0.001;}",i="void main() {gl_FragColor = vec4(0.0, 0.0, 0.0, 0.01);}",a=(y,$,B)=>{const O=y.createShader($);if(O)return y.shaderSource(O,B),y.compileShader(O),O},c=a(e,e.VERTEX_SHADER,n),p=a(e,e.FRAGMENT_SHADER,i);if(!c||!p)return;const d=e.createProgram();if(!d)return;e.attachShader(d,c),e.attachShader(d,p),e.linkProgram(d),e.useProgram(d);const m=new Float32Array(t),b=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,b),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW);const h=e.getAttribLocation(d,"noise");e.enableVertexAttribArray(h),e.vertexAttribPointer(h,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1)},nt=Object.entries({"iframe html hook":{onlyOnceEnable:!0,condition:e=>e.conf?.hookBlankIframe,onEnable:e=>{const t=new MutationObserver(i=>{if(i.length!=1)for(const a of i)for(const c of a.addedNodes)c.nodeName==="IFRAME"&&e.hookIframe(c)});t.observe(e.win.document.documentElement,{childList:!0,subtree:!0});const n=()=>{t.disconnect(),e.win.removeEventListener("DOMContentLoaded",n,{capture:!0}),e.win.removeEventListener("load",n,{capture:!0})};e.win.addEventListener("DOMContentLoaded",n,{capture:!0}),e.win.addEventListener("load",n,{capture:!0})}},"iframe script hook":{condition:e=>e.conf?.hookBlankIframe,onEnable:e=>{if(!e.rawObjects.appendChild||!e.rawObjects.insertBefore||!e.rawObjects.replaceChild){const t=(n,i,a)=>{const c=n.apply(i,a),p=a[0];return p?.tagName==="IFRAME"&&e.hookIframe(p),c};e.rawObjects.appendChild||(e.rawObjects.appendChild=e.win.HTMLElement.prototype.appendChild,e.win.HTMLElement.prototype.appendChild=new Proxy(e.rawObjects.appendChild,{apply:t})),e.rawObjects.insertBefore||(e.rawObjects.insertBefore=e.win.HTMLElement.prototype.insertBefore,e.win.HTMLElement.prototype.insertBefore=new Proxy(e.rawObjects.insertBefore,{apply:t})),e.rawObjects.replaceChild||(e.rawObjects.replaceChild=e.win.HTMLElement.prototype.replaceChild,e.win.HTMLElement.prototype.replaceChild=new Proxy(e.rawObjects.replaceChild,{apply:t}))}},onDisable:e=>{e.rawObjects.appendChild&&(e.win.HTMLElement.prototype.appendChild=e.rawObjects.appendChild,e.rawObjects.appendChild=void 0),e.rawObjects.insertBefore&&(e.win.HTMLElement.prototype.insertBefore=e.rawObjects.insertBefore,e.rawObjects.insertBefore=void 0),e.rawObjects.replaceChild&&(e.win.HTMLElement.prototype.replaceChild=e.rawObjects.replaceChild,e.rawObjects.replaceChild=void 0)}},"hook getOwnPropertyDescriptor":{onEnable:e=>{if(!e.rawObjects.getOwnPropertyDescriptor){e.rawObjects.getOwnPropertyDescriptor=e.win.Object.getOwnPropertyDescriptor;const t=e.rawObjects.navigatorDescriptor??e.win.Object.getOwnPropertyDescriptor(e.win,"navigator"),n=e.rawObjects.screenDescriptor??e.win.Object.getOwnPropertyDescriptor(e.win,"screen");e.win.Object.getOwnPropertyDescriptor=new Proxy(e.rawObjects.getOwnPropertyDescriptor,{apply:(i,a,c)=>{const[p,d]=c;if(p===e.win){if(d==="navigator")return t;if(d==="screen")return n}return i.apply(a,c)}})}},onDisable:e=>{e.rawObjects.getOwnPropertyDescriptor&&(e.win.Object.getOwnPropertyDescriptor=e.rawObjects.getOwnPropertyDescriptor,e.rawObjects.getOwnPropertyDescriptor=void 0)}},"hook navigator":{condition:e=>!e.isAllDefault(e.conf?.fingerprint?.navigator),onEnable:e=>{e.rawObjects.navigatorDescriptor||(e.rawObjects.navigatorDescriptor=e.win.Object.getOwnPropertyDescriptor(e.win,"navigator"),e.win.Object.defineProperty(e.win,"navigator",{value:new Proxy(e.win.navigator,{get:(t,n)=>{switch(n){case"userAgent":{const c=e.getSeedByHookValue(e.conf?.fingerprint?.navigator?.equipment);return H(n),c===null?t[n]:se(c,t)}case"appVersion":{const c=e.getSeedByHookValue(e.conf?.fingerprint?.navigator?.equipment);return H(n),c===null?t[n]:se(c,t,!0)}case"userAgentData":{const c=e.getSeedByHookValue(e.conf?.fingerprint?.navigator?.equipment);return H(n),c===null?t[n]:tt(c,t[n])}}const i=e.getValue("navigator",n);if(i!==null)return i;const a=t[n];return typeof a=="function"?a.bind(t):a}})}))},onDisable:e=>{e.rawObjects.navigatorDescriptor&&(e.win.Object.defineProperty(e.win,"navigator",e.rawObjects.navigatorDescriptor),e.rawObjects.navigatorDescriptor=void 0)}},"hook screen":{condition:e=>!e.isAllDefault(e.conf?.fingerprint?.screen),onEnable:e=>{e.rawObjects.screenDescriptor||(e.rawObjects.screenDescriptor=e.win.Object.getOwnPropertyDescriptor(e.win,"screen"),e.win.Object.defineProperty(e.win,"screen",{value:new Proxy(e.win.screen,{get:(t,n)=>{const i=e.getValue("screen",n);if(i!==null)return i;const a=t[n];return typeof a=="function"?a.bind(t):a}})}))},onDisable:e=>{e.rawObjects.screenDescriptor&&(e.win.Object.defineProperty(e.win,"screen",e.rawObjects.screenDescriptor),e.rawObjects.screenDescriptor=void 0)}},"hook canvas":{condition:e=>e.conf?.fingerprint?.other?.canvas?.type!==w.default,onEnable:e=>{e.rawObjects.getContext||(e.rawObjects.getContext=e.win.HTMLCanvasElement.prototype.getContext,e.win.HTMLCanvasElement.prototype.getContext=new Proxy(e.rawObjects.getContext,{apply:(t,n,i)=>{if(i[0]==="2d"){const a=i[1]??{};a.willReadFrequently=!0,i[1]=a}return t.apply(n,i)}})),e.rawObjects.getImageData||(e.rawObjects.getImageData=e.win.CanvasRenderingContext2D.prototype.getImageData,e.win.CanvasRenderingContext2D.prototype.getImageData=new Proxy(e.rawObjects.getImageData,{apply:(t,n,i)=>{const a=e.getValue("other","canvas");return a!==null?ae(e.rawObjects.getImageData,a,n,...i):t.apply(n,i)}}))},onDisable:e=>{e.rawObjects.getImageData&&(e.win.CanvasRenderingContext2D.prototype.getImageData=e.rawObjects.getImageData,e.rawObjects.getImageData=void 0),e.rawObjects.getContext&&(e.win.HTMLCanvasElement.prototype.getContext=e.rawObjects.getContext,e.rawObjects.getContext=void 0)}},"hook webgl":{condition:e=>e.conf?.fingerprint?.other?.webgl?.type!==w.default,onEnable:e=>{e.rawObjects.readPixels||(e.rawObjects.readPixels=e.win.WebGLRenderingContext.prototype.readPixels,e.win.WebGLRenderingContext.prototype.readPixels=new Proxy(e.rawObjects.readPixels,{apply:(t,n,i)=>{const a=e.getValue("other","webgl");return a&&ce(n,a),t.apply(n,i)}})),e.rawObjects.getSupportedExtensions||(e.rawObjects.getSupportedExtensions=e.win.WebGLRenderingContext.prototype.getSupportedExtensions,e.win.WebGLRenderingContext.prototype.getSupportedExtensions=new Proxy(e.rawObjects.getSupportedExtensions,{apply:(t,n,i)=>{const a=t.apply(n,i);if(a){const c=e.getValue("other","webgl");a.push?.("EXT_"+c[0]+c[1])}return a}}))},onDisable:e=>{e.rawObjects.readPixels&&(e.win.WebGLRenderingContext.prototype.readPixels=e.rawObjects.readPixels,e.rawObjects.readPixels=void 0),e.rawObjects.getSupportedExtensions&&(e.win.WebGLRenderingContext.prototype.getSupportedExtensions=e.rawObjects.getSupportedExtensions,e.rawObjects.getSupportedExtensions=void 0)}},"hook toDataURL":{condition:e=>e.conf?.fingerprint?.other?.canvas?.type!==w.default||e.conf?.fingerprint?.other?.webgl?.type!==w.default,onEnable:e=>{e.rawObjects.toDataURL||(e.rawObjects.toDataURL=e.win.HTMLCanvasElement.prototype.toDataURL,e.win.HTMLCanvasElement.prototype.toDataURL=new Proxy(e.rawObjects.toDataURL,{apply:(t,n,i)=>{if(e.conf?.fingerprint?.other?.canvas?.type!==w.default){const a=n.getContext("2d");if(a){const c=e.getValue("other","canvas");return c&&ae(e.rawObjects.getImageData,c,a,0,0,n.width,n.height),t.apply(n,i)}}if(e.conf?.fingerprint?.other?.webgl?.type!==w.default){const a=n.getContext("webgl");if(a){const c=e.getValue("other","webgl");return c&&ce(a,c),t.apply(n,i)}}return t.apply(n,i)}}))},onDisable:e=>{e.rawObjects.toDataURL&&(e.win.HTMLCanvasElement.prototype.toDataURL=e.rawObjects.toDataURL,e.rawObjects.toDataURL=void 0)}},"hook audio":{condition:e=>e.conf?.fingerprint?.other?.audio?.type!==w.default,onEnable:e=>{e.rawObjects.createDynamicsCompressor||(e.rawObjects.createDynamicsCompressor=e.win.OfflineAudioContext.prototype.createDynamicsCompressor,e.win.OfflineAudioContext.prototype.createDynamicsCompressor=new Proxy(e.rawObjects.createDynamicsCompressor,{apply:(t,n,i)=>{const a=e.getValue("other","audio");if(a===null)return t.apply(n,i);const c=t.apply(n,i),p=n.createGain();return p.gain.value=a*.01,c.connect(p),p.connect(n.destination),c}}))},onDisable:e=>{e.rawObjects.createDynamicsCompressor&&(e.win.OfflineAudioContext.prototype.createDynamicsCompressor=e.rawObjects.createDynamicsCompressor,e.rawObjects.createDynamicsCompressor=void 0)}},"hook timezone":{condition:e=>e.conf?.fingerprint?.other?.timezone?.type!==w.default,onEnable:e=>{e.rawObjects.DateTimeFormat||(e.rawObjects.DateTimeFormat=e.win.Intl.DateTimeFormat,e.win.Intl.DateTimeFormat=new Proxy(e.rawObjects.DateTimeFormat,{construct:(t,n,i)=>{const a=e.getValue("other","timezone");return n[0]=n[0]??a.locale,n[1]=Object.assign({timeZone:a.zone},n[1]),new t(...n)},apply:(t,n,i)=>{const a=e.getValue("other","timezone");return i[0]=i[0]??a.locale,i[1]=Object.assign({timeZone:a.zone},i[1]),t.apply(n,i)}})),e.rawObjects.getTimezoneOffset||(e.rawObjects.getTimezoneOffset=e.win.Date.prototype.getTimezoneOffset,e.win.Date.prototype.getTimezoneOffset=new Proxy(e.rawObjects.getTimezoneOffset,{apply:(t,n,i)=>e.getValue("other","timezone").offset*-60}))},onDisable:e=>{e.rawObjects.DateTimeFormat&&(e.win.Intl.DateTimeFormat=e.rawObjects.DateTimeFormat,e.rawObjects.DateTimeFormat=void 0),e.rawObjects.getTimezoneOffset&&(e.win.Date.prototype.getTimezoneOffset=e.rawObjects.getTimezoneOffset,e.rawObjects.getTimezoneOffset=void 0)}},"hook webrtc":{condition:e=>e.conf?.fingerprint?.other?.webrtc?.type!==w.default}}).map(([e,t])=>({...t,name:e})),rt={"navigator.language":He,"navigator.hardwareConcurrency":$e,"screen.height":e=>ne(e).height,"screen.width":e=>ne(e).width,"screen.colorDepth":Be,"screen.pixelDepth":_e,"other.canvas":We,"other.audio":qe,"other.webgl":ze,"other.webrtc":e=>"hello"},ot={"other.timezone":e=>e},k=new Map,it=ke(()=>{Ze(Object.fromEntries(k))}),H=function(e){const t=k.get(e)??0;k.set(e,t+1),it()};class G{win;info;seed;conf;rawObjects={};onlyRecord={};constructor(t,n,i){if(this.win=t,this.info=n,this.conf=i,this.seed={page:E(n.tabId),domain:Ke(n.host),browser:i.browserSeed??oe(),global:i.customSeed??oe()},!t)return;const a="__MyFingerprint__"+n.tabId;t[a]||(t[a]=!0,this.listenMessage(),this.refresh())}listenMessage(){this.win.addEventListener("message",t=>{const n=Ge(t.data);switch(n?.type){case R.SetConfig:{this.setConfig(n.config);break}case R.ChangeWhitelist:{n.mode==="into"?this.info.inWhitelist=!0:n.mode==="leave"&&(this.info.inWhitelist=!1),this.refresh();break}}})}isEnable(){return!!this.conf.enable&&!this.info.inWhitelist}setConfig(t){t&&(this.conf?this.conf=Ve(this.conf,t):this.conf=t,this.refresh())}refresh(){const t=this.isEnable();for(const n of nt)t&&(!n.condition||n.condition(this)===!0)?n.onlyOnceEnable===!0?this.onlyRecord[n.name]||(n.onEnable?.(this),this.onlyRecord[n.name]=!0):n.onEnable?.(this):n.onDisable?.(this)}hookIframe(t){new G(t.contentWindow,this.info,this.conf)}isAllDefault(t){if(!t)return!0;for(const n of Object.values(t))if(n.type!==w.default)return!1;return!0}getSeedByHookValue=t=>{switch(t?.type){case w.page:return this.seed.page;case w.domain:return this.seed.domain;case w.browser:return this.seed.browser;case w.global:return this.seed.global;case w.default:default:return null}};getValue(t,n,i){const a=this.conf.fingerprint?.[t]?.[n];if(!a)return null;H(n);const c=`${t}.${n}${i?"#"+i:""}`,p=rt[c];if(p){if(a.type===w.value)return null;const m=this.getSeedByHookValue(a);return p(m)}const d=ot[c];return d?a.type!==w.value||a.value===void 0?null:d(a.value):null}}const st=r,le=o;(()=>{const e=Xe(location.href);e&&new G(window,{tabId:st,host:e,inWhitelist:le.whitelist.includes(e)},le.config)})()}const me=1,Tt=["canvas","audio","webgl","webrtc","timezone"];let z;const ye=new Map,K={whitelist:"#fff",low:"#7FFFD4",high:"#F4A460"};let _;const he=()=>{const r=chrome.runtime.getManifest(),o={type:q.default},s={type:q.browser};return{version:r.version,config:{enable:!0,customSeed:Z(),browserSeed:Z(),fingerprint:{navigator:{equipment:s,language:o,hardwareConcurrency:o},screen:{height:o,width:o,colorDepth:o,pixelDepth:o},other:{timezone:o,canvas:s,audio:s,webgl:s,webrtc:o}},language:navigator.language,hookNetRequest:!0,hookBlankIframe:!0},whitelist:[]}},X=ct(async r=>{r=r??chrome.runtime.getManifest().version;const o=await chrome.storage.local.get();let s;return!o.version||lt(r,"2.0.0")<0?(await chrome.storage.local.clear(),s=he()):(s=De(he(),o),s.config.browserSeed=Z()),z={...s,whitelist:new Set(s.whitelist)},chrome.storage.local.set(s).then(()=>J()),z}),P=async()=>z||await X(),It=async()=>_||(_=(await fetch("https://api.github.com/repos/omegaee/my-fingerprint/releases/latest").then(o=>o.json())).tag_name,_),J=async()=>{const r=await P(),o={removeRuleIds:[me]};if(!r.config.enable||!r.config.hookNetRequest){chrome.declarativeNetRequest.updateSessionRules(o);return}const s=r.config.fingerprint.navigator.equipment;let l;switch(s.type){case q.browser:{l=r.config.browserSeed;break}case q.global:{l=r.config.customSeed;break}default:l=void 0}if(l){const u=[];u.push({header:"User-Agent",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:Rt(l,navigator)});const g=await At(l,navigator);g.brands&&u.push({header:"Sec-Ch-Ua",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:g.brands.map(f=>`"${f.brand}";v="${f.version}"`).join(", ")}),g.fullVersionList&&u.push({header:"Sec-Ch-Ua-Full-Version-List",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:g.fullVersionList.map(f=>`"${f.brand}";v="${f.version}"`).join(", ")}),g.uaFullVersion&&u.push({header:"Sec-Ch-Ua-Full-Version",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:g.uaFullVersion}),u.length&&(o.addRules=[{id:me,condition:{excludedInitiatorDomains:[...new Set([...r.whitelist].map(f=>f.split(":")[0]))],resourceTypes:Object.values(chrome.declarativeNetRequest.ResourceType)},action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,requestHeaders:u}}])}chrome.declarativeNetRequest.updateSessionRules(o)},Lt=je(r=>{chrome.storage.local.set({config:r.config})},500),Pt=je(r=>{chrome.storage.local.set({whitelist:[...r.whitelist]})},500),Vt=async r=>{const o=await P();o.config=De(o.config,r),Lt(o),(r.enable!==void 0||r.hookNetRequest!==void 0||r.fingerprint?.navigator?.equipment!==void 0)&&J()},Oe=async(r,o)=>{const s=await P();if(Array.isArray(o)){if(r==="add")for(const l of o)s.whitelist.add(l);else if(r==="del")for(const l of o)s.whitelist.delete(l)}else r==="add"?s.whitelist.add(o):r==="del"&&s.whitelist.delete(o);Pt(s),s.config.enable&&s.config.hookNetRequest&&s.config.fingerprint.navigator.equipment&&J()},Ft=r=>{let o=0,s=0;for(const[l,u]of Object.entries(r))Tt.includes(l)?s+=u:o+=u;return[String(s||o),s?K.high:K.low]},Se=r=>{chrome.action.setBadgeText({tabId:r,text:" "}),chrome.action.setBadgeBackgroundColor({tabId:r,color:K.whitelist})},Ut=r=>{chrome.action.setBadgeText({tabId:r,text:""})};chrome.runtime.onInstalled.addListener(({reason:r,previousVersion:o})=>{(r===chrome.runtime.OnInstalledReason.INSTALL||r===chrome.runtime.OnInstalledReason.UPDATE)&&X(o)});chrome.runtime.onStartup.addListener(()=>{X(chrome.runtime.getManifest().version)});chrome.runtime.onMessage.addListener((r,o,s)=>{switch(r.type){case D.SetConfig:{Vt(r.config),St({type:D.SetConfig,config:r.config});break}case D.GetNotice:return P().then(l=>{const u=l.whitelist.has(r.host);s(u?{type:"whitelist"}:{type:"record",data:ye.get(r.tabId)})}),!0;case D.SetHookRecords:{const l=o.tab?.id;if(l===void 0)return;ye.set(l,r.data);const[u,g]=Ft(r.data);chrome.action.setBadgeText({tabId:l,text:u}),chrome.action.setBadgeBackgroundColor({tabId:l,color:g});break}case D.UpdateWhitelist:{r.mode==="add"?(Oe("add",r.host),ge(r.host).then(l=>l.forEach(u=>{u.id&&(Se(u.id),fe(u.id,"into"))}))):r.mode==="del"&&(Oe("del",r.host),ge(r.host).then(l=>l.forEach(u=>{u.id&&(Ut(u.id),fe(u.id,"leave"))})));break}case D.GetNewVersion:return It().then(l=>{s(l)}),!0}});const Nt=(r,o)=>{chrome.scripting.executeScript({target:{tabId:r,allFrames:!0},world:"MAIN",injectImmediately:!0,args:[r,{...o,whitelist:[...o.whitelist]}],func:Mt})},Ht=(r,o)=>{const s=Y(o);s&&P().then(l=>{Nt(r,l),l.whitelist.has(s)&&Se(r)})};chrome.tabs.onUpdated.addListener((r,o,s)=>{s.url&&o.status==="loading"&&Ht(r,s.url)});
